<app-breadcrums />
<div class="content">
  <app-header />

  <div class="row barra-menu ">
    <div class="col text-end">
      <button (click)="funcSubmit()" class="btn btn-primary btn-sm ml-1"><i class="fas fa-save"></i> Guardar</button>
      <button (click)="funcCancelar()" class="btn btn-danger btn-sm ml-1"><i class="fas fa-reply"></i> Cancelar</button>
    </div>
  </div>
  
  <!-- <div class="row">
    <div class="col-4 col-md-2">
      <div class="card">
        <div class="card-body d-flexx ">
          <div class="mt-4 mr-3">
            <i class="far fa-clock t40 mr-2 text-secondary"></i>
          </div>
          <div  class="text-end">
            <h5 class="card-title h50">{{ultimo_logueo}}</h5>
            <p class="card-text text-primary"> Ultimo Ingreso</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-4 col-md-2">
      <div class="card">
        <div class="card-body d-flex">
          <div class="mt-4 mr-3">
            <i class="fas fa-users t40 mr-2 text-secondary"></i>
          </div>
          <div  class="text-end">
            <h5 class="card-title h50">{{grupo_usuario}}</h5>
            <p class="card-text text-primary">Grupo de Usuarios</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-4 col-md-2">
      <div class="card">
        <div class="card-body d-flex">
          <div class="mt-4 mr-3">
            <i class="fas fa-server text-secondary t40"></i>
          </div>
          <div class="text-end">
            <h5 class="card-title h50">{{lstSvrs.length}}</h5>
            <p class="card-text text-primary"> Servidores Asignados</p>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <div class="row">
    <div class="col col-md-6">
      <div class="card mt-3 h500">
        <div class="card-header th d-flex justify-content-between">
          <span> Información General </span>
        </div>
        <div class="p-1 row">
          @if (user.idrol == 1){
            <div class="col-4 col-md-3 td2 text-end">
              Rol de Usuario <small *ngIf="validador.idrol.requerido"><i class="text-danger">*</i></small>
              <br />
              <small><i class="text-secondary">Selección</i></small>
            </div>
            <div class="col-8 col-md-9 td2">
              <select [(ngModel)]="idrol" name="idrol" id="idrol" class="form-control">
                <option value="1">Owner</option>
                <option value="2">Creadores</option>
                <option value="3">Clientes</option>
              </select>
            </div>
  
            <div class="col-4 col-md-3 td2 text-end">
              Cliente <small *ngIf="validador.idcliente.requerido"><i class="text-danger">*</i></small>
              <br />
              <small><i class="text-secondary">Selección</i></small>
            </div>
            <div class="col-8 col-md-9 td2">
              <select [(ngModel)]="idcliente" (click)="getGrupoUsuarios()" name="idcliente" id="idcliente" class="form-control">
                @for (item of lstClientes; track $index) {
                  <option value="{{item.idcliente}}">{{item.nombre}}</option>
                }
              </select>
            </div>
          }


          <div class="col-4 col-md-3 td2 text-end">
            Grupo <small *ngIf="validador.idgrupo_usuario.requerido"><i class="text-danger">*</i></small>
            <br />
            <small><i class="text-secondary">{{validador.idgrupo_usuario.etiqueta}}</i></small>
          </div>
          <div class="col-8 col-md-9 td2">
            <select [(ngModel)]="idgrupo_usuario"  name="idcliente" id="idcliente" class="form-control">
              @if(lstGrupoUsuarios.length>0){ 
                @for (item of lstGrupoUsuarios; track $index) {
                  <option value="{{item.idgrupo_usuario}}">{{item.nombre}}</option>
                } 
              } @else{
                <option value="">-- No existen grupos definidos --</option>
              }
            </select>
             <sup>
              <i class=" {{validador.idgrupo_usuario.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                {{validador.idgrupo_usuario.validacion.resultado == '' ? validador.idgrupo_usuario.descripcion : validador.idgrupo_usuario.validacion.resultado}}
              </i>
            </sup>
          </div>
          
          <div class="col-4 col-md-3 td2 text-end">
            Nombre Completo <small *ngIf="validador.nombre.requerido"><i class="text-danger">*</i></small>
            <br />
            <small><i class="text-secondary">{{validador.nombre.etiqueta}}</i></small>
          </div>
          <div class="col-8 col-md-9 td2">
            <input
              type="text"
              name="nombre"
              id="nombre"
              class="form-control {{validador.nombre.validacion.resultado == '' ? '' : 'input-danger'}}"
              [(ngModel)]="nombre"
            />
            <sup>
              <i class=" {{validador.nombre.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                {{validador.nombre.validacion.resultado == '' ? validador.nombre.descripcion : validador.nombre.validacion.resultado}}
              </i>
            </sup>
          </div>


          <div class="col-4 col-md-3 td2 text-end">
            Usuario (login) <small *ngIf="validador.usuario.requerido"><i class="text-danger">*</i></small>
            <br />
            <small><i class="text-secondary">{{validador.usuario.etiqueta}}</i></small>
          </div>
          <div class="col-8 col-md-9 td2">
            <input
              type="text"
              name="usuario"
              id="usuario"
              class="form-control {{validador.usuario.validacion.resultado == '' ? '' : 'input-danger'}}"
              [(ngModel)]="usuario"
            />
            <sup>
              <i class=" {{validador.usuario.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                {{validador.usuario.validacion.resultado == '' ? validador.usuario.descripcion : validador.usuario.validacion.resultado}}
              </i>
            </sup>
          </div>


          <div class="col-4 col-md-3 td2 text-end">
            Email <small *ngIf="validador.email.requerido"><i class="text-danger">*</i></small>
            <br />
            <small><i class="text-secondary">{{validador.email.etiqueta}}</i></small>
          </div>
          <div class="col-8 col-md-9 td2">
            <input
              type="email"
              name="email"
              id="email"
              class="form-control {{validador.email.validacion.resultado == '' ? '' : 'input-danger'}}"
              [(ngModel)]="email"
            />
            <sup>
              <i class=" {{validador.email.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                {{validador.email.validacion.resultado == '' ? validador.email.descripcion : validador.email.validacion.resultado}}
              </i>
            </sup>
          </div>
          @if (idusuario!=""){
            <div class="col-4 col-md-3 td2 text-end">
              Identificador NTFY <small *ngIf="validador.ntfy_identificador.requerido"><i class="text-danger">*</i></small>
              <br />
              <small><i class="text-secondary">{{validador.ntfy_identificador.etiqueta}}</i></small>
            </div>
            <div class="col-8 col-md-9 td2">
              <input
                type="ntfy_identificador"
                name="ntfy_identificador"
                id="ntfy_identificador"
                class="form-control {{validador.ntfy_identificador.validacion.resultado == '' ? '' : 'input-danger'}}"
                [(ngModel)]="ntfy_identificador"
              />
              <sup>
                <i class=" {{validador.ntfy_identificador.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                  {{validador.ntfy_identificador.validacion.resultado == '' ? validador.ntfy_identificador.descripcion : validador.ntfy_identificador.validacion.resultado}}
                </i>
              </sup>
            </div>
          }

          <div class="col-4 col-md-3 td2 text-end">
            Estado <small *ngIf="validador.estado.requerido"><i class="text-danger">*</i></small>
            <br />
            <small><i class="text-secondary">{{validador.estado.etiqueta}}</i></small>
          </div>
          <div class="col-8 col-md-9 td2">
            <select [(ngModel)]="estado" name="idrol" id="idrol" class="form-control">
                <option value="1">Activo</option>
                <option value="0">Inactivo</option>
              </select>
            <sup>
              <i class=" {{validador.estado.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                {{validador.estado.validacion.resultado == '' ? validador.estado.descripcion : validador.estado.validacion.resultado}}
              </i>
            </sup>
          </div>


        </div>
      </div>

    </div>
    <!-- 
    <div class="col col-md-6">
      <div class="card mt-3">
        <div class="card-header th d-flex justify-content-between">
          <span> Asignación de Servidores </span>
        </div>
        <div class="p-3 row">
          <p>
            Habilita el acceso a los servidores señalados.
          </p>
          <div class="row align-items-center">
            <div class="col-auto">
              <input type="password" id="buscaSrv" class="form-control" aria-describedby="passwordHelpInline">
              <small><i>Filtro</i></small>
            </div>
            <div class="col-auto">
              <button class="btn btn-primary">Buscar</button>
            </div>
          </div>
          <div class="h300 scrollx">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th width="2% text-start">
                    <input
                      class="form-check-input t16"
                      [checked]="selectall"
                      (click)="selectAll()"
                      type="checkbox"
                    />
                  </th>
                  <th width="text-start">Localización</th>
                  <th width="text-start">Servidor</th>
                  <th width="text-start">Host</th>
                </tr>
              </thead>
              <tbody class="td">
                @for (item of lstServidores; track $index) {
                <tr class="td">
                  <td class="td">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input t16"
                        type="checkbox"
                        [(ngModel)]="item.check"
                        [checked]="item.check"
                        role="switch"
                        id="srv{{item.idservidor}}"
                      />
                    </div>
                  </td>
                  <td>{{item.localizacion}}</td>
                  <td>{{item.nombre}}</td>
                  <td>{{item.host}}:{{item.puerto}}</td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div> 
    -->
    <div class="col col-md-6">
      <div class="card mt-3">
        <div class="card-header th d-flex justify-content-between">
          <span> Lista de Servidores asignados</span>
        </div>
        <div class="p-1 row">
          <div class="col-4 col-md-2 td2 text-end">
            Servidores
              <small *ngIf="validador.servidores.requerido"><i class="text-danger">*</i></small>
            <br />
            <small><i class="text-secondary">Selección</i></small>
          </div>
          <div class="col-4 col-md-4 td2">
            <button  class="btn btn-primary btn-sm m-1" (click)="actualizaServidores()"
              data-bs-toggle="modal" data-bs-target="#ventanaModal"><i class="fas fa-plus"></i> Añadir</button> 
            <br>
            <sup>
              <i class=" {{validador.servidores.validacion.resultado == '' ? 'text-secondary' : 'text-danger' }}">
                {{validador.servidores.validacion.resultado == '' ?
                validador.servidores.descripcion :
                validador.servidores.validacion.resultado}}
              </i>
            </sup>
          </div>
        </div>
        <div #myGrid id="myGrid" class="ag-theme-quartz scrollx" style="height: 400px; min-height: 400px"></div>
      </div>
    </div>
  </div>
  
</div>




<div #modal class="modal modal-xl" id="ventanaModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Lista de Servidores</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="p-1 row">
          <div class="col-4 col-md-2 td2 text-end">
            texto a buscar
            <br />
            <small><i class="text-secondary">Alfanumérico</i></small>
          </div>
          <div class="col-8 col-md-4 td2">
            <input
              type="text"
              name="buscar"
              id="buscar"
              class="form-control"
              [(ngModel)]="buscar"
              (keyup)="filtrar()"
            />
            <sup><i class="text-secondary">Ingrese el texto a buscar por nombre, localizacion, host o puerto</i></sup>
          </div>
          <div class="col-8 col-md-1 td2">
            <button class="btn btn-link" title="Buscar"><i class="fas fa-search"></i></button>
            <br>
            <sup>&nbsp;</sup>
          </div>
        </div>
        <div class="p-3 row">
          <div class="h400">
            <table class="table table-striped table-hover  ">
              <thead>
                <tr>
                  <th>Servidor</th>
                  <th width="5%">Acción</th>
                </tr>
              </thead>
              <tbody>
                @for (item of lstServidores; track $index) {
                  @if(!item.check){
                    <tr>
                      <td>{{item.nombre}} - <i>{{item.localizacion}}</i> -  <strong>{{item.host}}:{{item.puerto}}</strong></td>
                      <td><button (click)="addItem(item.idservidor)" class="btn btn-link"><i class="fas fa-plus"></i></button></td>
                    </tr>
                  }
                }
              </tbody>
            </table>

          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>